RewriteEngine On

# ====================================
# 1. Forcer HTTPS
# ====================================
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# ====================================
# 2. Supprimer fbclid
# ====================================
RewriteCond %{QUERY_STRING} (^|&)fbclid= [NC]
RewriteRule ^ %{REQUEST_URI}? [R=301,L]

# ====================================
# 3. Page 404
# ====================================
ErrorDocument 404 /index.php?page=404
RewriteRule ^404$ index.php?page=404 [QSA,L]

# ====================================
# 4. Routing principal
# ====================================
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)$ index.php?page=$1 [QSA,L]

# ====================================
# 5. Sécurité
# ====================================
Options -Indexes

<FilesMatch "\.(env|log|ini|htaccess|htpasswd|sql)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>
